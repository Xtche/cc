<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <title>Manual WebRTC Signaling</title>
    </head>

    <body>
        <h2>Manual WebRTC Signaling</h2>
        <textarea id="localOffer" placeholder="Local Offer"></textarea><br>
        <button onclick="createOffer()">Create Offer</button><br>
        <textarea id="remoteOffer" placeholder="Paste Remote Offer Here"></textarea><br>
        <button onclick="startConnection()">Start Connection</button><br>
        <video id="localVideo" autoplay muted></video>
        <video id="remoteVideo" autoplay></video>

    </body>
    <script>
        // webrtc.js
        let localPeerConnection;
        let remotePeerConnection;
        const localVideo = document.getElementById('localVideo');
        const remoteVideo = document.getElementById('remoteVideo');

        // 获取媒体流并显示
        navigator.mediaDevices
            .getUserMedia({ video: true, audio: true })
            .then((stream) => {
                localVideo.srcObject = stream;
                localPeerConnection = new RTCPeerConnection();
                localPeerConnection.addStream(stream);
            })
            .catch((error) => {
                alert(error);
                console.error('MediaStream error: ', error);
            });

        function createOffer () {
            localPeerConnection
                .createOffer()
                .then((offer) => {
                    localPeerConnection.setLocalDescription(offer);
                    document.getElementById('localOffer').value = JSON.stringify(offer);
                })
                .catch((error) => {
                    alert(error);
                    console.error('Offer creation error: ', error);
                });
        }

        function startConnection () {
            const remoteOffer = JSON.parse(document.getElementById('remoteOffer').value);
            remotePeerConnection = new RTCPeerConnection();
            remotePeerConnection.ontrack = (event) => {
                remoteVideo.srcObject = event.streams[0];
            };
            remotePeerConnection
                .setRemoteDescription(new RTCSessionDescription(remoteOffer))
                .then(() => {
                    return navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                })
                .then((stream) => {
                    remotePeerConnection.addStream(stream);
                    return remotePeerConnection.createAnswer();
                })
                .then((answer) => {
                    remotePeerConnection.setLocalDescription(answer);
                    document.getElementById('localOffer').value = JSON.stringify(answer);
                })
                .catch((error) => {
                    alert(error);
                    console.error('Connection start error: ', error);
                });
        }

    </script>

</html>
